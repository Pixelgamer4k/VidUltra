# AI Development Journal

## Session: November 23, 2025

### Objective
Fix persistent "Black Screen" and "Permission Loop" issues by implementing a robust, FreeDcam-inspired architecture.

### Current State
- **Issue:** The app shows a black screen or gets stuck in a permission loop ("Closing camera" logs).
- **Diagnosis:** The current architecture (`remember { CameraController }` inside Composable) is fragile. Configuration changes or permission dialogs cause the controller to be recreated or disposed incorrectly, leading to race conditions and resource leaks.
- **Solution:** Adopt a **ViewModel-based Architecture**.
    - **CameraViewModel:** Survives configuration changes, holds the `CameraController` singleton-like instance, and manages the state machine.
    - **Separation of Concerns:** UI (Compose) only renders state; ViewModel handles logic.
    - **Robust Lifecycle:** Explicitly handle `ON_RESUME`/`ON_PAUSE` in the ViewModel to ensure the camera is only opened when safe.

### Actions Taken
1.  **Debugging:** Added LogServer (port 9000) and on-screen logs. Confirmed "Closing camera" loop.
2.  **Dependencies:** Added `lifecycle-viewmodel-compose`.
3.  **Refactoring:**
    - Creating `CameraViewModel.kt`.
    - Refactoring `CameraController.kt` to be passive (controlled by VM).
    - Updating `CameraScreen.kt` to observe VM state.

### Next Steps
- Implement `CameraViewModel`.
- Verify fix on device.
